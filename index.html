<style>
.spinner {
  width: 40px;
  height: 40px;
display: none;
  position: relative;
  margin: 100px auto;
}

.double-bounce1, .double-bounce2 {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-color: #333;
  opacity: 0.6;
  position: absolute;
  top: 0;
  left: 0;
  
  -webkit-animation: sk-bounce 2.0s infinite ease-in-out;
  animation: sk-bounce 2.0s infinite ease-in-out;
}

.double-bounce2 {
  -webkit-animation-delay: -1.0s;
  animation-delay: -1.0s;
}

@-webkit-keyframes sk-bounce {
  0%, 100% { -webkit-transform: scale(0.0) }
  50% { -webkit-transform: scale(1.0) }
}

@keyframes sk-bounce {
  0%, 100% { 
    transform: scale(0.0);
    -webkit-transform: scale(0.0);
  } 50% { 
    transform: scale(1.0);
    -webkit-transform: scale(1.0);
  }
}
</style>

<body>
Enter your url here:<br/>

URL: <input type="url" id="urlId" value="" placeholder="url" />
<br />Prediction key: <input type="text" id="predictionKey" placeholder="prediction key" />
<br />Name <input type="text" id="name" placeholder="name" />
<br />Email <input type="text" id="email" placeholder="email" />
<br/>
<button type="button" id="submitBtn">Score</button>
<br />
<div id="results">

</div>
<div class="spinner" id="loading">
  <div class="double-bounce1"></div>
  <div class="double-bounce2"></div>
  Loading...
</div>


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.min.js"></script>
<script>
/*https://gist.github.com/openfirmware/7144867 */
var nativeAjax;

nativeAjax = $.ajax;

$.delay = function(ms, value) {
  var defer = new $.Deferred();
  setTimeout(function() { defer.resolve(value); }, ms || 0);
  return defer.promise();
};

// ---
// generated by coffee-script 1.9.2


let imgUrls = {
  "https://user-images.githubusercontent.com/1689183/38528620-51827dbe-3c15-11e8-8d7a-3e58fc6b5d86.png": "stanford",
  "https://user-images.githubusercontent.com/1689183/38528638-7025323e-3c15-11e8-8548-a22d3cfb6c31.png": "stanford",
  "https://user-images.githubusercontent.com/1689183/38528688-8ec175fe-3c15-11e8-9348-78ae2ddfdb17.png": "stanford",
  "https://user-images.githubusercontent.com/1689183/38528732-b1376422-3c15-11e8-81ce-ecd3e72961a1.png": "stanford",
  "https://user-images.githubusercontent.com/1689183/38528783-e77e1cc4-3c15-11e8-999a-1da32fe5627e.png": "stanford",
  "https://user-images.githubusercontent.com/1689183/38528805-058b44da-3c16-11e8-8639-80411990dff4.png": "stanford",
  "https://i.imgur.com/1u5AJ7V.jpg": "berkeley",
"https://i.imgur.com/dGE0TOH.jpg": "berkeley",
"https://i.imgur.com/mOXUFDQ.jpg": "berkeley",
"https://i.imgur.com/vtcK3NH.jpg": "berkeley",
"https://i.imgur.com/4LfKgdR.jpg": "berkeley"
};
$(function() {
  // $("input#urlId").val("https://southcentralus.api.cognitive.microsoft.com/customvision/v1.1/Prediction/51655126-47a9-4148-a9a3-165b48668fbb/url?iterationId=d6ece231-e2bd-419e-898b-6f448774094b");
  // $("input#predictionKey").val("30d2b3de6c4642e0be643f90995d7b66");
  $("#submitBtn").click(function() {
    $("#loading").show();
    let scores = [];
    let endpoint = $("input#urlId").val();
    let predictionKey  = $("input#predictionKey").val();
    let name = $("#name").val();
    let email = $("#email").val();
    if (!name || !email)
      {alert("Fill out your name and email"); $("#loading").hide(); return;}
    submitResults(name, email, 0);
    let queue = [];
    let predictions = {};
    let correctOrNot = {};
    let i = 0;
    let numDone = 0;
    for (let imgUrl in imgUrls) {
      setTimeout(() => {
        ($.ajax({
          type: "POST",
          url: endpoint,
          dataType: "json",
          contentType: "application/json;charset=utf-8",
          data: JSON.stringify({
            "Url": imgUrl
          }),
          headers: {
            "Prediction-Key": predictionKey,
          }
        }).then(e => {
          let actualPrediction = imgUrls[imgUrl];
          let maxTag = _.maxBy(e.Predictions, e => e.Probability).Tag;
          predictions[imgUrl] = maxTag;
          console.log(maxTag);
          correctOrNot[imgUrl] = maxTag.toLowerCase().trim() == actualPrediction.toLowerCase().trim();
          numDone++;
          if (numDone == i) {
            finished();
          }
        }
        ));
      }, i * 700);
      i++;
    }
    function finished() {
      $("#results").html("");
      let i = 0;
      let correct = 0;
      for (let url in correctOrNot) {
        i++;
        $("#results").append(`<br><b>Image ${i}: </b>` + (correctOrNot[url] ? "CORRECT": "INCORRECT"));
        correctOrNot[url] && correct++;
      }
      let total = i;
      $("#results").append(`<br><b>TOTAL: ${correct} out of ${total}</b>`);
      let accuracy = correct / total * 100.0;
      $("#results").append(`<br><h3>FINAL ACCURACY: ${accuracy}%</h3>`);
      submitResults(name, email, accuracy);

      // console.log(predictions, correctOrNot);

    }
  });
})
function submitResults(name, email, score) {
        $.get(`https://hooks.zapier.com/hooks/catch/3152671/f255u0/?Name=${name}&Email=${email}&Score=${score}`).done(e => {
              $("#loading").hide();
      })      
}
</script>

</body>